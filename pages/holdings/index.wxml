<view class="page-shell ui-page pb-40rpx">
  <!-- 顶部导航区 -->
  <view class="ui-header flex items-end pb-16rpx">
    <view>
      <view class="text-36rpx font-bold text-hex-111827">我的持仓</view>
      <view class="text-24rpx text-hex-6B7280 mt-8rpx">
        把握市场脉搏，智享财富增值
      </view>
    </view>
  </view>

  <!-- 1. 资产概览卡片 (复刻 iOS PortfolioSummaryCard) -->
  <view class="ui-section">
    <view
      class="relative overflow-hidden rounded-32rpx bg-gradient-to-br from-hex-3B82F6 to-hex-A855F7 text-white shadow-lg">
      <!-- 装饰背景圆圈 (CSS模拟 iOS GeometryReader) -->
      <view class="absolute -right-60rpx -top-40rpx w-300rpx h-300rpx bg-white opacity-10 rounded-full"></view>
      <view class="absolute -left-40rpx -bottom-40rpx w-200rpx h-200rpx bg-white opacity-10 rounded-full"></view>

      <view class="relative z-10 p-40rpx">
        <!-- 第一行：总资产 + 收益胶囊 -->
        <view class="flex justify-between items-start mb-32rpx">
          <view class="flex flex-col">
            <view class="text-24rpx opacity-80 font-medium tracking-wide mb-8rpx">预估总市值 (CNY)</view>
            <view class="text-64rpx font-bold font-numeric tracking-tight">{{ summary.totalEstimateAmount }}</view>
          </view>

          <!-- 收益状态胶囊 -->
          <view class="flex items-center gap-4rpx px-16rpx py-8rpx bg-white bg-opacity-20 rounded-full">
            <van-icon name="{{ summary.totalPercentageChange >= 0 ? 'ascending' : 'descending' }}" color="#fff"
              size="10px" />
            <view class="text-24rpx font-bold">{{ summary.totalPercentageChange >= 0 ? '+' : '' }}{{
              summary.totalPercentageChange }}%</view>
          </view>
        </view>

        <!-- 分割线 -->
        <view class="h-1px bg-white opacity-20 w-full mb-32rpx"></view>

        <!-- 第二行：指标网格 (持仓成本 | 预估盈亏 | 数量) -->
        <view class="flex items-center text-center">
          <!-- 1. 持仓成本 -->
          <view class="flex-1 flex flex-col gap-6rpx">
            <view class="text-22rpx opacity-70">持仓成本</view>
            <view class="text-30rpx font-bold font-numeric">{{ summary.totalHoldingAmount }}</view>
          </view>

          <view class="w-1px h-40rpx bg-white opacity-30"></view>

          <!-- 2. 预估盈亏 -->
          <view class="flex-1 flex flex-col gap-6rpx">
            <view class="text-22rpx opacity-70">预估盈亏</view>
            <view class="text-30rpx font-bold font-numeric">
              {{ summary.totalProfitLoss >= 0 ? '+' : '' }}{{ summary.totalProfitLoss }}
            </view>
          </view>

          <view class="w-1px h-40rpx bg-white opacity-30"></view>

          <!-- 3. 持仓数量 -->
          <view class="flex-1 flex flex-col gap-6rpx">
            <view class="text-22rpx opacity-70">持仓数量</view>
            <view class="text-30rpx font-bold font-numeric">{{ summary.count }} 只</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 2. 行情简报 (保留原功能) -->
  <view class="ui-section mt-16rpx">
    <scroll-view scroll-x class="whitespace-nowrap w-full" enable-flex>
      <view class="flex gap-16rpx pb-8rpx">
        <view wx:for="{{ indices }}" wx:key="code"
          class="bg-white rounded-16rpx p-20rpx min-w-170rpx shadow-sm flex flex-col justify-center">
          <view class="text-24rpx text-hex-6B7280 mb-8rpx">{{ item.name }}</view>
          <view class="flex items-baseline gap-8rpx">
            <view
              class="text-32rpx font-bold font-numeric {{ item.changeRate >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ item.value }}
            </view>
            <view class="text-20rpx font-numeric {{ item.changeRate >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ item.changeRate }}%
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 3. 持仓列表 (复刻 iOS HoldingRowView + MP 特性) -->
  <view class="px-32rpx pb-32rpx">
    <view class="flex flex-col gap-16rpx mb-24rpx mt-32rpx">
      <!-- 标题行 + 过滤器 -->
      <view class="flex items-center justify-between">
        <view class="text-28rpx font-bold text-hex-374151">基金列表</view>

        <!-- 仅看持仓 Filter Toggle -->
        <view
          class="flex items-center gap-8rpx px-20rpx py-8rpx rounded-full border transition-all active:scale-95 {{ filterHeld ? 'bg-hex-E0F2F1 border-hex-0D9488' : 'bg-white border-hex-E5E7EB' }}"
          bindtap="onFilterHeldTap">
          <van-icon name="{{ filterHeld ? 'eye-o' : 'closed-eye' }}" size="14px"
            color="{{ filterHeld ? '#0D9488' : '#9CA3AF' }}" />
          <view class="text-22rpx font-medium {{ filterHeld ? 'text-hex-0D9488' : 'text-hex-6B7280' }}">仅看持仓</view>
        </view>
      </view>

      <view class="flex items-center justify-between gap-12rpx pb-4rpx">
        <view class="text-22rpx text-hex-9CA3AF mr-4rpx flex-shrink-0">排序</view>

        <view class="flex items-center gap-12rpx">
          <!-- 按金额 -->
          <view
            class="flex-shrink-0 flex items-center gap-4rpx px-24rpx py-10rpx rounded-16rpx border transition-all {{ sortBy === 'holdingAmount' ? 'bg-hex-EEF2FF text-hex-3B82F6 border-hex-C7D2FE font-bold shadow-sm' : 'bg-white text-hex-6B7280 border-hex-E5E7EB' }}"
            bindtap="onSortTap" data-sort="holdingAmount">
            <view class="text-22rpx">持有金额</view>
            <van-icon wx:if="{{ sortBy === 'holdingAmount' }}"
              name="{{ sortOrder === 'asc' ? 'arrow-up' : 'arrow-down' }}" size="12px" />
          </view>

          <!-- 按今日涨跌 -->
          <view
            class="flex-shrink-0 flex items-center gap-4rpx px-24rpx py-10rpx rounded-16rpx border transition-all {{ sortBy === 'todayChange' ? 'bg-hex-EEF2FF text-hex-3B82F6 border-hex-C7D2FE font-bold shadow-sm' : 'bg-white text-hex-6B7280 border-hex-E5E7EB' }}"
            bindtap="onSortTap" data-sort="todayChange">
            <view class="text-22rpx">今日涨跌</view>
            <van-icon wx:if="{{ sortBy === 'todayChange' }}"
              name="{{ sortOrder === 'asc' ? 'arrow-up' : 'arrow-down' }}" size="12px" />
          </view>

          <!-- 按累计收益 -->
          <view
            class="flex-shrink-0 flex items-center gap-4rpx px-24rpx py-10rpx rounded-16rpx border transition-all {{ sortBy === 'totalProfitRate' ? 'bg-hex-EEF2FF text-hex-3B82F6 border-hex-C7D2FE font-bold shadow-sm' : 'bg-white text-hex-6B7280 border-hex-E5E7EB' }}"
            bindtap="onSortTap" data-sort="totalProfitRate">
            <view class="text-22rpx">累计收益</view>
            <van-icon wx:if="{{ sortBy === 'totalProfitRate' }}"
              name="{{ sortOrder === 'asc' ? 'arrow-up' : 'arrow-down' }}" size="12px" />
          </view>
        </view>
      </view>
    </view>

    <van-empty wx:if="{{ !holdings.length }}" description="暂无持仓" />

    <view class="flex flex-col gap-24rpx">
      <fund-card wx:for="{{ holdings }}" wx:key="code" fund="{{ item }}" bind:click="toDetail" />
    </view>
  </view>

  <van-toast id="van-toast" />
</view>