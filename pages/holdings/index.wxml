<view class="min-h-screen bg-gray-50 pb-10">
  <!-- 1. 资产概览卡片 (搬运自 PortfolioSummaryCard.vue) -->
  <view class="p-4">
    <view class="bg-primary rounded-3xl p-6 text-white shadow-lg relative overflow-hidden">
      <!-- 装饰背景 -->
      <view class="absolute -right-10 -top-10 w-40 h-40 bg-white opacity-10 rounded-full"></view>

      <view class="text-sm opacity-80 mb-1">总市值 (元)</view>
      <view class="text-4xl font-bold font-mono mb-6 text-white">{{ summary.totalEstimateAmount }}</view>

      <van-row>
        <van-col span="12">
          <view class="text-xs opacity-80">当日盈亏</view>
          <view class="text-lg font-bold">
            <!-- 格式化后显示 -->
            {{ summary.totalProfitLoss >= 0 ? '+' : '' }}{{ summary.totalProfitLoss }}
          </view>
        </van-col>
        <van-col span="12">
          <view class="text-xs opacity-80">总收益率</view>
          <view class="text-lg font-bold">{{ summary.totalPercentageChange }}%</view>
        </van-col>
      </van-row>
    </view>
  </view>

  <!-- 2. 行情简报 (搬运自 MarketOverview.vue) -->
  <view class="px-4 mb-4">
    <scroll-view scroll-x class="whitespace-nowrap w-full">
      <view class="inline-flex gap-3">
        <view wx:for="{{ indices }}" wx:key="code" class="bg-white p-3 rounded-xl shadow-sm min-w-100px">
          <view class="text-xs text-gray-500">{{ item.name }}</view>
          <view class="text-sm font-bold {{ item.changeRate >= 0 ? 'text-red-500' : 'text-green-500' }}">
            {{ item.value }}
          </view>
          <view class="text-10px {{ item.changeRate >= 0 ? 'text-red-400' : 'text-green-400' }}">
            {{ item.changeRate }}%
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 3. 持仓列表 -->
  <view class="px-4 space-y-3">
    <view wx:for="{{ holdings }}" wx:key="code" class="bg-white rounded-2xl p-4 shadow-sm mb-3" bindtap="toDetail"
      data-code="{{ item.code }}">

      <!-- 第一行：名称与涨跌幅 -->
      <view class="flex justify-between items-start mb-2">
        <view>
          <view class="font-bold text-hex-1F2937 text-base">{{ item.name }}</view>
          <text class="text-xs text-hex-9CA3AF font-mono">{{ item.code }}</text>
        </view>
        <view class="text-right">
          <!-- 右上角主要展示：今日估算涨跌幅 -->
          <view
            class="text-lg font-bold font-numeric {{ item.percentageChange >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
            {{ item.percentageChange >= 0 ? '+' : '' }}{{ item.percentageChange }}%
          </view>
        </view>
      </view>

      <!-- 第二行：安全状态 + 交易点阵 (热点图) -->
      <view class="flex items-center gap-3 h-6 mb-2">
        <!-- 7天持有期提示 -->
        <view wx:if="{{ item.lastBuyStatus }}"
          class="text-10px px-12rpx py-4rpx rounded border flex items-center gap-1 {{ item.lastBuyStatus.isSafe ? 'bg-hex-F9FAFB text-hex-9CA3AF border-hex-E5E7EB' : 'bg-hex-FFFBEB text-hex-F59E0B border-hex-FDE68A animate-pulse' }}">
          <van-icon name="{{ item.lastBuyStatus.isSafe ? 'shield-check-o' : 'clock-o' }}" size="10px" />
          <text class="font-bold">{{ item.lastBuyStatus.label }}</text>
        </view>

        <!-- 分隔线 -->
        <view wx:if="{{ item.recentTransactions.length }}" class="w-1px h-3 bg-hex-E5E7EB"></view>

        <!-- 交易热点图 (由右向左排列) -->
        <view class="flex flex-row-reverse items-center">
          <view wx:for="{{ item.formattedRecentTxs }}" wx:for-item="tx" wx:key="id" class="relative ml--4rpx">
            <view class="w-20rpx h-20rpx rounded-full border border-white {{ tx.colorClass }}"
              style="z-index: {{ 10 - index }}"></view>
          </view>
        </view>
      </view>

      <!-- 第三行：待确认交易标签 (Pending) -->
      <view wx:if="{{ item.pendingTransactions.length }}" class="flex flex-wrap gap-2 mb-3">
        <view wx:for="{{ item.pendingTransactions }}" wx:for-item="ptx" wx:key="id"
          class="text-10px px-2 py-4rpx rounded border flex items-center gap-1 {{ ptx.type === 'buy' ? 'bg-hex-FEF2F2 text-hex-EF4444 border-hex-FEE2E2' : 'bg-hex-F0FDF4 text-hex-22C55E border-hex-DCFCE7' }}">
          <view class="w-12rpx h-12rpx rounded-full bg-current animate-ping"></view>
          <text>{{ ptx.typeLabel }}: {{ ptx.displayValue }}</text>
        </view>
      </view>

      <!-- [第四部分：数值详情 - 核心修改区] -->
      <view class="flex justify-between border-t border-hex-F9FAFB pt-3">
        <!-- 1. 持有市值 -->
        <view class="w-1/3">
          <view class="text-10px text-hex-9CA3AF">持有市值</view>
          <view class="text-sm font-mono font-bold text-hex-1F2937">¥{{ item.holdingAmount }}</view>
        </view>

        <!-- 2. 持有总盈亏 (累计) -->
        <view class="w-1/3 text-center">
          <view class="text-10px text-hex-9CA3AF">持有收益</view>
          <view class="flex flex-col">
            <text
              class="text-sm font-mono font-bold {{ item.holdingProfitAmount >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ item.holdingProfitAmount >= 0 ? '+' : '' }}{{ item.holdingProfitAmount }}
            </text>
            <text class="text-10px font-mono {{ item.holdingProfitRate >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ item.holdingProfitRate >= 0 ? '+' : '' }}{{ item.holdingProfitRate }}%
            </text>
          </view>
        </view>

        <!-- 3. 今日估算盈亏 (当日波动) -->
        <view class="w-1/3 text-right">
          <view class="text-10px text-hex-9CA3AF">估算盈亏</view>
          <view class="flex flex-col" wx:if="{{ item.todayProfitAmount !== null }}">
            <text
              class="text-sm font-mono font-bold {{ item.todayProfitAmount >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ item.todayProfitAmount >= 0 ? '+' : '' }}{{ item.todayProfitAmount }}
            </text>
            <text class="text-10px font-mono {{ item.percentageChange >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ item.percentageChange >= 0 ? '+' : '' }}{{ item.percentageChange }}%
            </text>
          </view>
          <view wx:else class="text-xs text-hex-D1D5DB italic mt-1">未持仓</view>
        </view>
      </view>

    </view>
  </view>

  <van-toast id="van-toast" />
</view>