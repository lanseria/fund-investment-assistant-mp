<!-- components/fund-card/index.wxml -->
<view class="bg-white rounded-32rpx shadow-sm overflow-hidden active:scale-98 transition-transform" bindtap="onTap">
  <view class="p-32rpx">
    <!-- A. 顶部行：名称 + 板块 + 代码 -->
    <view class="flex items-start justify-between mb-24rpx">
      <view class="flex flex-col gap-8rpx flex-1 mr-16rpx min-w-0">
        <!-- 名称 -->
        <view class="text-32rpx font-bold text-hex-1F2937 truncate">{{ fund.name }}</view>

        <!-- 辅助行：板块标签 + 代码 + 待确认胶囊 -->
        <view class="flex flex-wrap items-center gap-8rpx">
          <!-- 板块 Tag -->
          <view wx:if="{{ fund.sectorLabel }}"
            class="bg-hex-EFF6FF text-hex-3B82F6 text-20rpx px-12rpx py-4rpx rounded-8rpx font-semibold">
            {{ fund.sectorLabel }}
          </view>

          <view class="text-22rpx text-hex-9CA3AF font-mono">{{ fund.code }}</view>

          <!-- 待确认交易 -->
          <block wx:if="{{ fund.pendingTransactions && fund.pendingTransactions.length }}">
            <view wx:for="{{ fund.pendingTransactions }}" wx:for-item="ptx" wx:key="id"
              class="text-18rpx px-8rpx py-2rpx rounded border flex items-center gap-4rpx {{ ptx.type === 'buy' ? 'bg-hex-FEF2F2 text-hex-EF4444 border-hex-FEE2E2' : 'bg-hex-F0FDF4 text-hex-22C55E border-hex-DCFCE7' }}">
              <van-icon name="clock-o" />
              <view>{{ ptx.typeLabel }}</view>
            </view>
          </block>
        </view>
      </view>

      <!-- 右侧：今日盈亏 (统一显示逻辑) -->
      <view class="flex flex-col items-end gap-8rpx">
        <!-- 如果有具体金额，显示金额 + 涨跌幅胶囊 -->
        <block wx:if="{{ fund.todayProfitAmount !== null && fund.todayProfitAmount !== undefined }}">
          <view
            class="text-36rpx font-bold font-numeric {{ fund.todayProfitAmountRaw >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
            {{ fund.todayProfitAmountRaw >= 0 ? '+' : '' }}{{ fund.todayProfitAmount }}
          </view>
          <view
            class="px-12rpx py-4rpx rounded-full flex items-center {{ fund.percentageChangeRaw >= 0 ? 'bg-hex-FEF2F2 text-hex-EF4444' : 'bg-hex-F0FDF4 text-hex-22C55E' }}">
            <view class="text-22rpx font-semibold">
              {{ fund.percentageChangeRaw >= 0 ? '+' : '' }}{{ fund.percentageChange }}%
            </view>
          </view>
        </block>
        <!-- 否则如果是关注基金，仅显示实时收益率 -->
        <block wx:elif="{{ fund.isWatchOnly }}">
          <view
            class="text-36rpx font-bold font-numeric {{ fund.percentageChangeRaw >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
            {{ fund.percentageChangeRaw >= 0 ? '+' : '' }}{{ fund.percentageChange }}%
          </view>
        </block>
        <!-- 否则回退显示 -- (兼容异常情况) -->
        <block wx:else>
          <view class="text-36rpx font-bold font-numeric text-hex-D1D5DB">--</view>
        </block>
      </view>
    </view>

    <!-- 分割线 -->
    <view class="h-1px bg-hex-F3F4F6 w-full mb-24rpx"></view>

    <!-- B. 数据行：持有市值 | 持有收益 -->
    <view class="flex items-center">
      <!-- 持有市值 -->
      <view class="flex-1 flex flex-col gap-4rpx">
        <view class="text-20rpx text-hex-9CA3AF">持有市值</view>
        <block wx:if="{{ fund.isWatchOnly }}">
          <view class="text-26rpx font-bold font-numeric text-hex-D1D5DB">--</view>
        </block>
        <block wx:else>
          <view class="text-26rpx font-bold font-numeric text-hex-1F2937">¥{{ fund.holdingAmount }}</view>
        </block>
      </view>

      <view class="w-1px h-24rpx bg-hex-E5E7EB mx-16rpx"></view>

      <!-- 持有收益 -->
      <view class="flex-1 flex flex-col gap-4rpx">
        <view class="text-20rpx text-hex-9CA3AF">持有收益</view>
        <block wx:if="{{ fund.isWatchOnly }}">
          <view class="text-26rpx font-bold font-numeric text-hex-D1D5DB">--</view>
        </block>
        <block wx:else>
          <view class="flex items-baseline gap-8rpx">
            <view
              class="text-26rpx font-bold font-numeric {{ fund.holdingProfitAmountRaw >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ fund.holdingProfitAmountRaw >= 0 ? '+' : '' }}{{ fund.holdingProfitAmount }}
            </view>
            <view class="text-20rpx {{ fund.holdingProfitRateRaw >= 0 ? 'text-hex-EF4444' : 'text-hex-22C55E' }}">
              {{ fund.holdingProfitRateRaw >= 0 ? '+' : '' }}{{ fund.holdingProfitRate }}%
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- C. 底部 Footer：热点图与安全提示 -->
  <view wx:if="{{ (fund.formattedRecentTxs && fund.formattedRecentTxs.length) || fund.lastBuyStatus }}"
    class="bg-hex-F9FAFB px-32rpx py-16rpx flex justify-between items-center border-t border-hex-F3F4F6">

    <!-- 交易热点图 -->
    <view class="flex items-center gap-6rpx">
      <view wx:for="{{ fund.formattedRecentTxs }}" wx:for-item="tx" wx:key="id"
        class="w-12rpx h-12rpx rounded-full {{ tx.colorClass }}"></view>
    </view>

    <!-- 7天安全状态 -->
    <view wx:if="{{ fund.lastBuyStatus }}" class="flex items-center gap-8rpx">
      <view
        class="w-10rpx h-10rpx rounded-full {{ fund.lastBuyStatus.isSafe ? 'bg-hex-10B981' : 'bg-hex-F59E0B animate-pulse' }}">
      </view>
      <view class="text-20rpx font-medium {{ fund.lastBuyStatus.isSafe ? 'text-hex-6B7280' : 'text-hex-F59E0B' }}">
        {{ fund.lastBuyStatus.label }}
      </view>
    </view>
  </view>
</view>